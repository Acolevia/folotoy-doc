---
id: web-tool
title: 固件升级和问题诊断
sidebar_label: 固件升级和问题诊断
---

这个[网页](https://tool.folotoy.com/index)旨在为您的设备提供三种主要操作：刷机、日志和对话。

## 驱动安装

* MacOS 下可以直接使用 Chrome (v89以上，需要支持 Web Serial 接口)刷机，不需要安装驱动
* 如果系统没有自带串口驱动，需要安装好串口驱动，[驱动下载](https://www.wch.cn/downloads/category/67.html?feature=USB%E8%BD%AC%E4%B8%B2%E5%8F%A3&product_name=CH340)。


<img src="https://user-images.githubusercontent.com/41461127/281996998-de76550b-5701-40dd-a115-38988f78a1c8.png" />

- 刷机：此功能使您可以轻松更新设备的固件。
- 日志：使用此功能查看设备的实时日志，有助于有效地调试和故障排除。
- 对话：此功能使您可以查看和管理与设备相关的对话内容。

*** Windows 用户可能需要安装[ 驱动 ](https://www.wch.cn/downloads/category/67.html?feature=USB%E8%BD%AC%E4%B8%B2%E5%8F%A3&product_name=CH340)后，设备才能连接上电脑。 ***

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";

<Tabs
defaultValue="program"
values={[
{ label: '刷机', value: 'program'},
{ label: '抹除', value: 'erase'},
{ label: '日志', value: 'console'},
{ label: '对话', value: 'dialogue'}
]}>
<TabItem value="program">

要开始刷机，您需要下载适当的固件，选择正确的波特率，并按照步骤连接和写入固件。详细的操作步骤如下：

<img src="https://user-images.githubusercontent.com/41461127/281997006-e7e25ec8-5501-41cd-81b1-8529ea73cacf.png" />

1. 访问刷机：在界面中点击'刷机'选项。

2. 下载固件：访问[固件下载页面](https://github.com/FoloToy/folotoy-bin/releases/)并选择与您的设备对应的固件。

3. 选择波特率：下载固件后，您需要选择正确的通信波特率。对于Windows用户，推荐的波特率为921600。对于macOS用户，推荐的波特率为460800。或者，您可以使用默认的波特率。

4. 连接：点击'连接'按钮与您的设备建立连接。

<img src="https://user-images.githubusercontent.com/41461127/281996985-2035d87f-ca5e-434a-85d5-50dbb73dd50e.png" />


5. 选择固件并写入：选择下载的固件文件，将地址设为0x0，然后点击'写入'按钮。等待几分钟，固件就会写入您的设备。

<img src="https://user-images.githubusercontent.com/41461127/281997011-8f89d911-fe91-407d-8845-52b912540840.png" />
<img src="https://user-images.githubusercontent.com/41461127/281997502-9fdb3ff7-8fe4-4d4f-a210-cff10d681451.png" />
<img src="https://user-images.githubusercontent.com/41461127/281997016-9d660483-1377-466d-a801-7534da1ce8d4.png" />

</TabItem>

<TabItem value="erase">

*** 执行设备擦除将删除设备上的所有内容，此操作不可逆。如果您执行了设备擦除，请联系我们进行设备恢复。***

要抹除设备，请按照以下步骤操作：

<img src="https://user-images.githubusercontent.com/41461127/281997006-e7e25ec8-5501-41cd-81b1-8529ea73cacf.png" />

1. 访问刷机：在界面中点击'刷机'选项。

2. 选择波特率：下载固件后，您需要选择正确的通信波特率。对于Windows用户，推荐的波特率为921600。对于macOS用户，推荐的波特率为460800。或者，您可以使用默认的波特率。

3. 连接：点击'连接'按钮与您的设备建立连接。

<img src="https://user-images.githubusercontent.com/41461127/281996985-2035d87f-ca5e-434a-85d5-50dbb73dd50e.png" />


4. 抹除：点击右上角的'抹除'按钮抹除设备

<img src="https://user-images.githubusercontent.com/41461127/281997011-8f89d911-fe91-407d-8845-52b912540840.png" />

</TabItem>

<TabItem value="console">

要查看设备的实时日志，请按照以下步骤操作：

<img src="https://user-images.githubusercontent.com/41461127/281996988-d4c1fc26-fe02-4d82-bb89-0af8df732126.png" />

1. 访问日志：在界面中点击'日志'选项。

2. 连接设备：连接您的设备。一旦连接成功，您应该能够在控制台中看到设备的实时日志。

3. AT 指令：您可以输入一些 AT 指令来便捷的配置设备。

### AT 指令
*** 修改配置后都需要重启设备才能生效 ***

- 仅支持英文输入法且为小写字母
1. 查看配置文件
    ```json
    at+config=?
    ```

2. 查看所有的 AT 指令
    ```json
    at+command=?
    ````

3. 查看按键配置

    ```json
    at+keys=?
    ```

4. 配置对话按键

  - 例：对话按键定义为 GPIO 27

    ```json
    at+keys=talk,<GPIO> // at+keys=talk,27
    ```

5. 配置重置 WIFI 按键

  - 例：将 WIFI 重置按键定义为 GPIO 29 和 GPIO 30

    ```json
    at+keys=wifi_rst,<GPIO>;<GPIO> // at+keys=wifi_rst,29;30
    ```

6. 配置进入连续对话模式按键

  - 例：将 WIFI 重置按键定义为 GPIO 29 和 GPIO 30

    ```json
    at+keys=dialogue,<GPIO>;<GPIO> // at+keys=dialogue,29;30
    ```

7. 重启配置（修改配置文件后，重启才能生效）

    ```json
    at+reboot
    ```

8. 配置角色

  - 如果没有配置过，则角色 id 默认为 1

  - 例：将角色 1 的按键定义为 GPIO 22

    ```json
    at+keys=role_idx,<index>,<GPIO> // at+keys=role_idx,1,22
    ```

  - 例：删除角色 1 的按键定义
    
    ```json
    at+keys=role_idx,<index>,<GPIO> // at+keys=role_idx,1,0
    ```

9. 配置切换角色按键

  - 例：配置 GPIO 27 为切换上一个角色

    ```json
    at+keys=role_prev,<GPIO>  // at+keys=role_prev,27
    ```

  - 例：配置 GPIO 28 为切换下一个角色

    ```json
    at+keys=role_next,<GPIO>  // at+keys=role_next,28
    ```

10. 修改配置中的 MQTT

  - 例：修改 Broker 为 192.168.52.1

    ```json
    at+config=mqtt,broker,<broker> // at+config=mqtt,broker,192.168.52.1
    ```

  - 例： 修改 Port 为1883

    ```json
    at+config=mqtt,port,<port> // at+config=mqtt,port,1883
    ```

  - 同时修改 Broker 和 Port

    ```json
    at+config=mqtt,broker,<broker>;port,<port> // at+config=mqtt,broker,192.168.52.1;port,1883
    ```
11. 修改配置中的 WIFI

  - 例： 修改 SSID 为 test-wifi

    ```json
    at+config=wifi,ssid,<ssid> // at+config=wifi, ssid, test-wifi
    ```

  - 例： 修改密码为 123456

    ```json
    at+config=wifi,password,<password> // at+config=wifi,password,123456
    ```

  - 同时修改 SSID 和密码

    ```json
    at+config=wifi,ssid,<ssid>;password,<password> // at+config=wifi,ssid,test-wifi;password,123456
    ```

12. 修改配置中连续对话的声音阈值

  - 例：修改声音阈值为 100

    ```json
    at+config=common,voice,<threshold> // at+config=common,voice, 100
    ```

13. 连续对话

    ```json
    at+command=dialogue,start //进入连续对话
    at+command=dialogue,stop //退出连续对话
    ```

14. 重置 WIFI 并进入配网模式

    ```json
    at+command=wifi,reset
    ```


</TabItem>
<TabItem value="dialogue">

*** 在使用该功能前，请先确保 MQTT 功能在服务器上已处于开启状态, 具体设置[查看](./integrations/mqtt.md) ***

要在HTTPS网站上使用Websocket，您需要进行以下设置：

1. 点击地址栏左侧的图标，然后点击“站点设置”。

<img src="https://user-images.githubusercontent.com/41461127/282994109-3117e901-ed00-4748-b72e-56ad95659415.png" />

2. 将“不安全内容”设置为“允许”。

<img src="https://user-images.githubusercontent.com/41461127/282992948-80724a74-8581-4937-9220-5bf1c5e69e1c.png" />

为了确保更安全的连接，您可以通过在服务器上配置SSL来使用SSL上的Websocket。Websocket over SSL可能需要激活才能使用。以下是如何激活的指南：

1. 在配置了SSL的服务器上，确保Websocket服务器正在运行并侦听适当的端口。

2. 输入服务器的地址和端口。

3. 点击“激活”按钮。

<img src="https://user-images.githubusercontent.com/41461127/282994811-675ebd20-334b-48e4-a134-1a98aec117ac.png" />

4. 会弹出一个页面询问您是否确认继续访问该站点。选择“继续”或类似选项来激活该地址。

5. Websocket over SSL连接现在应该已经激活并准备就绪。

要连接设备并查看实时对话内容，请按照以下步骤操作：

<img src="https://user-images.githubusercontent.com/41461127/283020535-a0ec9ac9-d653-4e84-b2f3-cc347486c619.png" />


1. 访问对话：在界面中点击'对话'选项。


2. 输入连接细节：在连接对话页面，输入以下信息：
    - Client ID：这是您连接的唯一标识符。
    - 地址：这是您的设备将要连接的服务器地址。
    - 端口：这是您的设备将要连接的服务器的端口号。
    - SN（序列号）：这可以在设备日志中找到。
    - 用户名：这是服务器连接的用户名。
    - 密码：这是服务器连接的密码。
    
3. 连接：点击'连接'按钮。一旦成功连接，您将能够查看设备的实时对话内容。

<img src="https://user-images.githubusercontent.com/41461127/281996977-6d332466-bc35-4dab-b7af-c0c6af210fc5.png" />
</TabItem>
</Tabs>